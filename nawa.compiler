#!/usr/bin/env python3
"""
Nawa - A Simple Python Compiler/Interpreter
Run Python code files or enter interactive mode
"""

import sys
import os
import traceback
from code import InteractiveConsole

class NawaCompiler:
    def __init__(self):
        self.version = "1.0.0"
        self.console = InteractiveConsole()
    
    def print_banner(self):
        """Display Nawa banner"""
        print("=" * 50)
        print(f"  Nawa Python Compiler v{self.version}")
        print("  Type 'exit()' or press Ctrl+D to quit")
        print("=" * 50)
    
    def compile_file(self, filename):
        """Compile and execute a Python file"""
        if not os.path.exists(filename):
            print(f"Error: File '{filename}' not found")
            return False
        
        try:
            with open(filename, 'r') as f:
                code = f.read()
            
            print(f"Compiling {filename}...")
            compiled = compile(code, filename, 'exec')
            
            print(f"Executing {filename}...\n")
            exec(compiled, {'__name__': '__main__'})
            return True
            
        except SyntaxError as e:
            print(f"Syntax Error in {filename}:")
            print(f"  Line {e.lineno}: {e.msg}")
            if e.text:
                print(f"  {e.text.strip()}")
            return False
            
        except Exception as e:
            print(f"Runtime Error in {filename}:")
            traceback.print_exc()
            return False
    
    def interactive_mode(self):
        """Start interactive REPL mode"""
        self.print_banner()
        print("\nInteractive Mode - Enter Python code:\n")
        
        try:
            self.console.interact(banner="", exitmsg="")
        except SystemExit:
            pass
        
        print("\nGoodbye!")
    
    def run(self, args):
        """Main entry point"""
        if len(args) == 0:
            # No arguments - interactive mode
            self.interactive_mode()
        elif len(args) == 1:
            # One argument - compile file
            filename = args[0]
            success = self.compile_file(filename)
            sys.exit(0 if success else 1)
        else:
            # Help message
            print("Usage:")
            print("  python nawa.py              - Start interactive mode")
            print("  python nawa.py <file.py>    - Compile and run a Python file")
            sys.exit(1)

def main():
    compiler = NawaCompiler()
    compiler.run(sys.argv[1:])

if __name__ == "__main__":
    main()
